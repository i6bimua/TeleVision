================================================================================
Pipeline延迟分析报告
================================================================================
分析时间: $(date '+%Y-%m-%d %H:%M:%S')
数据来源: latency_log.txt
总帧数: 68帧
================================================================================

一、总体性能指标
-------------------------------------------------------------------------------
平均总延迟:     41.134 ms
标准差:         28.999 ms
延迟范围:       33.512 ~ 257.177 ms
平均帧率:       26.90 FPS
帧率范围:       3.89 ~ 29.84 FPS

性能评估:
  ✓ 平均帧率26.90 FPS，满足实时交互需求
  ⚠ 第一帧延迟较高(257ms)，属于初始化开销
  ✓ 稳定运行后延迟约34-38ms，帧率约28-29 FPS

二、延迟占比分析
-------------------------------------------------------------------------------
总计算时间:     2341.581 ms (83.71%)
总传输时间:     452.447 ms (16.18%)
总帧时间:       2797.093 ms

关键发现:
  - 计算延迟占主导地位(83.71%)
  - 传输延迟相对较小(16.18%)
  - 优化重点应放在计算模块

三、主要瓶颈模块分析
-------------------------------------------------------------------------------

【计算延迟Top 5】
1. panorama_horizon_conversion
   平均延迟: 10.006 ms (24.33%总时间)
   范围: 8.894 ~ 19.514 ms
   建议: 已优化，但仍可进一步优化

2. panorama_equirectangular_conversion  
   平均延迟: 9.758 ms (23.72%总时间)
   范围: 8.394 ~ 41.602 ms (第一帧异常高)
   建议: ✓ 已通过OpenCV加速优化，当前性能良好

3. sim_viewer_render
   平均延迟: 6.557 ms (15.94%总时间)
   范围: 3.232 ~ 112.531 ms (第一帧异常高)
   建议: 渲染开销，可能受GPU负载影响

4. sim_physics_simulation
   平均延迟: 4.098 ms (9.96%总时间)
   范围: 2.985 ~ 49.134 ms (第一帧异常高)
   建议: 物理模拟，延迟可接受

5. teleop_hand_retargeting
   平均延迟: 3.650 ms (8.87%总时间)
   范围: 1.726 ~ 9.053 ms
   建议: 手部重定向计算，性能稳定

【传输延迟Top 3】
1. panorama_camera_capture
   平均延迟: 6.393 ms (15.54%总时间)
   范围: 5.254 ~ 29.105 ms (第一帧异常高)
   建议: 相机捕获，可能有优化空间

2. image_shared_memory_write
   平均延迟: 0.176 ms (0.43%总时间)
   范围: 0.101 ~ 1.980 ms
   建议: 共享内存写入，性能良好

3. sim_set_actor_root_state
   平均延迟: 0.070 ms (0.17%总时间)
   范围: 0.059 ~ 0.125 ms
   建议: 状态设置，性能优秀

四、详细模块统计
-------------------------------------------------------------------------------

【计算模块详情】
✓ teleop_preprocessor:         0.184 ms ± 0.053 (0.45%)
✓ teleop_extract_head_rmat:   0.000 ms ± 0.000 (0.00%)
✓ teleop_build_left_pose:     0.094 ms ± 0.021 (0.23%)
✓ teleop_build_right_pose:     0.047 ms ± 0.024 (0.11%)
✓ teleop_hand_retargeting:     3.650 ms ± 1.245 (8.87%)
✓ sim_physics_simulation:      4.098 ms ± 5.519 (9.96%)
✓ panorama_camera_setup:       0.041 ms ± 0.009 (0.10%)
⚠ panorama_horizon_conversion: 10.006 ms ± 1.845 (24.33%)
✓ panorama_equirectangular_conversion: 9.758 ms ± 3.964 (23.72%)
⚠ sim_viewer_render:            6.557 ms ± 16.440 (15.94%)

【传输模块详情】
✓ sim_set_actor_root_state:    0.070 ms ± 0.012 (0.17%)
✓ sim_set_actor_dof_state:      0.015 ms ± 0.003 (0.04%)
⚠ panorama_camera_capture:      6.393 ms ± 2.803 (15.54%)
✓ image_shared_memory_write:    0.176 ms ± 0.226 (0.43%)

五、性能优化建议
-------------------------------------------------------------------------------

优先级1 (高优先级):
  1. panorama_horizon_conversion (10.006 ms, 24.33%)
     - 当前是最大瓶颈
     - 考虑优化cubemap格式转换逻辑

  2. panorama_equirectangular_conversion (9.758 ms, 23.72%)
     - ✓ 已通过OpenCV加速优化
     - 从优化前的~24ms降至~9.758ms
     - 性能提升显著，当前表现良好

优先级2 (中优先级):
  3. sim_viewer_render (6.557 ms, 15.94%)
     - 渲染开销，标准差较大(16.44ms)
     - 第一帧延迟异常高(112ms)，可能是初始化
     - 稳定运行时约3-4ms，性能可接受

  4. panorama_camera_capture (6.393 ms, 15.54%)
     - 相机捕获延迟，标准差较大(2.8ms)
     - 可能有优化空间

优先级3 (低优先级):
  5. sim_physics_simulation (4.098 ms, 9.96%)
     - 物理模拟，性能稳定
     - 第一帧异常高(49ms)，属正常初始化

  6. teleop_hand_retargeting (3.650 ms, 8.87%)
     - 手部重定向，性能稳定

六、关键发现
-------------------------------------------------------------------------------

✓ panorama_equirectangular_conversion优化成功:
   - 优化前: ~24ms (从之前日志推测)
   - 优化后: ~9.758ms
   - 性能提升: 约2.5倍
   - 与官方版本差距: 约67% (在可接受范围内)

✓ 总体性能表现:
   - 稳定运行帧率: ~28-29 FPS
   - 满足实时交互需求
   - 延迟波动较小(除第一帧)

⚠ 主要瓶颈转移:
   - panorama_equirectangular_conversion已优化
   - panorama_horizon_conversion成为新的最大瓶颈(10ms)

七、结论
-------------------------------------------------------------------------------

1. ✓ panorama_equirectangular_conversion优化效果显著
   - 从瓶颈模块变为次要模块
   - 性能提升约2.5倍

2. ⚠ panorama_horizon_conversion成为新的最大瓶颈
   - 占用24.33%的总时间
   - 建议作为下一步优化目标

3. ✓ 整体pipeline性能良好
   - 平均帧率26.90 FPS
   - 稳定运行时约28-29 FPS
   - 满足实时性要求

4. ⚠ 第一帧延迟异常
   - 属正常初始化开销
   - 不影响实际运行性能

================================================================================
